<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulador PPR Coletivo</title>

  <style>
    :root{
      --bg:#0f0f10;
      --panel:#141417;
      --panel2:#101114;
      --stroke:rgba(255,255,255,.08);
      --stroke2:rgba(255,255,255,.12);
      --text:#f5f6f7;
      --muted:#b8bcc6;
      --red:#e60012;

      --wine1: rgba(125, 0, 18, .55);
      --wine2: rgba(125, 0, 18, .18);

      --radius:18px;
      --shadow: 0 14px 34px rgba(0,0,0,.42);
      --shadow2: 0 10px 24px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 18% 0%, rgba(230,0,18,.22), transparent 55%),
        radial-gradient(900px 600px at 100% 18%, rgba(230,0,18,.10), transparent 60%),
        var(--bg);
    }

    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:22px 18px 34px;
    }

    /* Header (padrão sóbrio) */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding:14px 16px;
      border:1px solid var(--stroke);
      border-radius:22px;
      background: linear-gradient(135deg, rgba(255,255,255,.03), rgba(125,0,18,.10));
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 220px;
    }
    .brand .t1{
      font-size:16px;
      font-weight:700;
      letter-spacing:.2px;
    }
    .brand .t2{
      font-size:12px;
      color:var(--muted);
    }
    .badge{
      margin-left:auto;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
      transition:.2s;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(230,0,18,.55); }
    .btn.primary{
      background:var(--red);
      border-color:transparent;
    }
    .btn.primary:hover{ filter:brightness(1.05); }

    /* Layout */
    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* Header interno (degradê vinho) */
    .cardHead{
      padding:16px 16px 14px;
      background:
        radial-gradient(900px 260px at 10% 0%, var(--wine1), transparent 60%),
        linear-gradient(90deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border-bottom:1px solid var(--stroke);
    }
    .cardHeadRow{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
    }
    .hTitle{
      font-size:18px;
      font-weight:800;
      margin:0;
    }
    .hSub{
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    .valueBox{
      padding:14px 16px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }
    .bigValue{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 240px;
    }
    .bigValue .label{
      color:var(--muted);
      font-size:12px;
    }
    .bigValue .money{
      font-size:44px;
      font-weight:900;
      letter-spacing:.4px;
      line-height:1;
    }
    .bigValue .baseLine{
      color:var(--muted);
      font-size:12px;
    }

    .form{
      padding:0 16px 16px;
    }

    .fields{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:12px;
    }
    @media (max-width: 980px){
      .fields{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 520px){
      .fields{ grid-template-columns: 1fr; }
    }

    .field{
      padding:12px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.22);
    }
    .fieldTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .fieldTop .name{
      font-weight:800;
      font-size:13px;
    }
    .fieldTop .hint{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    input[type="text"], input[type="number"]{
      width:100%;
      border-radius:14px;
      border:1px solid var(--stroke2);
      padding:12px 12px;
      font-size:16px;
      color:var(--text);
      background: rgba(0,0,0,.35);
      outline:none;
    }
    input:focus{
      border-color: rgba(230,0,18,.65);
      box-shadow: 0 0 0 3px rgba(230,0,18,.12);
    }

    /* Blocos de fórmula */
    .formula{
      padding: 0 16px 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .rowFormula{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:10px;
    }
    .chip{
      min-width: 170px;
      flex: 1 1 170px;
      padding:14px 14px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.25);
      text-align:center;
    }
    .chip.red{
      background: rgba(230,0,18,.85);
      border-color: rgba(230,0,18,.35);
    }
    .chip .c1{
      font-weight:900;
      font-size:16px;
      margin-bottom:6px;
    }
    .chip .c2{
      font-weight:900;
      font-size:28px;
      letter-spacing:.4px;
    }
    .op{
      font-size:22px;
      font-weight:900;
      opacity:.75;
      padding: 0 4px;
    }

    /* Painel direito */
    .sideBody{
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .tableCard{
      border:1px solid var(--stroke);
      border-radius:18px;
      background: rgba(0,0,0,.22);
      overflow:hidden;
    }
    .tableHead{
      padding:14px 14px;
      font-weight:900;
      font-size:14px;
      border-bottom:1px solid var(--stroke);
      background:
        radial-gradient(900px 220px at 10% 0%, var(--wine2), transparent 62%),
        rgba(255,255,255,.02);
    }
    table{
      width:100%;
      border-collapse:collapse;
    }
    th, td{
      padding:11px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      text-align:left;
      font-size:13px;
    }
    th{ color:var(--muted); font-weight:800; }
    tr:last-child td{ border-bottom:none; }

    /* Ocorrências */
    .occTools{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      padding:12px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.02);
    }
    .occTools input{
      flex: 1 1 220px;
      min-width: 220px;
    }
    .miniNote{
      color:var(--muted);
      font-size:12px;
      padding: 0 12px 12px;
      line-height:1.35;
    }
    .qty{
      width:92px;
      text-align:right;
    }
    .qty input{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      font-size:14px;
    }
    .codeCell{
      width:92px;
      color:var(--muted);
      font-weight:800;
    }

    .footerNote{
      margin-top:14px;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
      padding: 0 6px;
    }

    .toast{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,.75);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text);
      font-size: 13px;
      opacity: 0;
      pointer-events: none;
      transition: .25s;
      box-shadow: var(--shadow2);
    }
    .toast.show{ opacity:1; }

  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar">
      <div class="brand">
        <div class="t1">Simulador PPR 2025</div>
        <div class="t2">Coletivo (com ocorrências e faltas)</div>
      </div>

      <div class="actions">
        <button class="btn" id="btnHome" type="button">Home</button>
        <button class="btn primary" id="btnCopy" type="button">Copiar valor</button>
        <button class="btn" id="btnReset" type="button">Resetar</button>
      </div>

      <div class="badge">Coca-Cola FEMSA • Uso interno</div>
    </div>

    <div class="grid">

      <!-- ESQUERDA -->
      <div class="card">
        <div class="cardHead">
          <div class="cardHeadRow">
            <h2 class="hTitle">Simulador PPR Coletivo</h2>
          </div>
          <div class="hSub">
            Considera: <b>Resultado Coletivo</b>, <b>Extra por Ocorrência</b> (calculado pela soma das ocorrências) e <b>Coeficiente por Faltas Não Justificadas</b>.
          </div>
        </div>

        <div class="valueBox">
          <div class="bigValue">
            <div class="label">Seu PPR estimado</div>
            <div class="money" id="pprBig">R$ 0</div>
            <div class="baseLine" id="baseLine">Base: Salário Dez/25 • Meses • Resultado Coletivo • Extra • Coef. Faltas</div>
          </div>
        </div>

        <div class="form">
          <div class="fields">
            <div class="field">
              <div class="fieldTop">
                <div class="name">Resultado Coletivo</div>
                <div class="hint">ex: 1,00</div>
              </div>
              <input id="inpColetivo" type="text" inputmode="decimal" placeholder="1,00" />
            </div>

            <div class="field">
              <div class="fieldTop">
                <div class="name">Salário Dez/25 (R$)</div>
                <div class="hint">digite seu valor</div>
              </div>
              <input id="inpSalario" type="text" inputmode="decimal" placeholder="0,00" />
            </div>

            <div class="field">
              <div class="fieldTop">
                <div class="name">Meses Trabalhados</div>
                <div class="hint">1–12</div>
              </div>
              <input id="inpMeses" type="number" min="1" max="12" step="1" placeholder="12" />
            </div>

            <div class="field">
              <div class="fieldTop">
                <div class="name">Faltas Não Justificadas</div>
                <div class="hint">0+</div>
              </div>
              <input id="inpFaltas" type="number" min="0" step="1" placeholder="0" />
            </div>
          </div>
        </div>

        <div class="formula">
          <div class="rowFormula">
            <div class="chip red">
              <div class="c1">Coletivo</div>
              <div class="c2" id="vColetivo">0,0000</div>
            </div>

            <div class="op">+</div>

            <div class="chip red">
              <div class="c1">Extra</div>
              <div class="c2" id="vExtra">0,0000</div>
            </div>

            <div class="op">×</div>

            <div class="chip red">
              <div class="c1">Coef. Faltas</div>
              <div class="c2" id="vCoef">0,00</div>
            </div>
          </div>

          <div class="rowFormula">
            <div class="chip red">
              <div class="c1">Salário</div>
              <div class="c2" id="vSalario">R$ 0,00</div>
            </div>

            <div class="op">×</div>

            <div class="chip">
              <div class="c1">Meses/12</div>
              <div class="c2" id="vMeses">0/12</div>
            </div>

            <div class="op">=</div>

            <div class="chip">
              <div class="c1">PPR (R$)</div>
              <div class="c2" id="vPpr">R$ 0,00</div>
            </div>
          </div>

          <div class="footerNote">
            Valores arredondados para exibição. Pode haver desconto de IR e contribuições conforme regras vigentes.
          </div>
        </div>
      </div>

      <!-- DIREITA -->
      <div class="card">
        <div class="sideBody">

          <div class="tableCard">
            <div class="tableHead">Valor do Extra por Ocorrência</div>
            <table>
              <thead>
                <tr>
                  <th>Quantidade de Ocorrências</th>
                  <th style="text-align:right">Valor do Extra</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>0,0 a 0,99</td><td style="text-align:right">0,20</td></tr>
                <tr><td>1,0 a 2,99</td><td style="text-align:right">0,15</td></tr>
                <tr><td>3,0 a 4,99</td><td style="text-align:right">0,10</td></tr>
                <tr><td>5,0 a 6,99</td><td style="text-align:right">0,05</td></tr>
                <tr><td>&ge; 7,00</td><td style="text-align:right">0</td></tr>
              </tbody>
            </table>
          </div>

          <div class="tableCard">
            <div class="tableHead">Coeficiente por Faltas Não Justificadas</div>
            <table>
              <thead>
                <tr>
                  <th>Faltas Não Justificadas</th>
                  <th style="text-align:right">Valor do Coeficiente</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>0</td><td style="text-align:right">1,00</td></tr>
                <tr><td>1</td><td style="text-align:right">0,95</td></tr>
                <tr><td>2</td><td style="text-align:right">0,90</td></tr>
                <tr><td>3</td><td style="text-align:right">0,85</td></tr>
                <tr><td>4</td><td style="text-align:right">0,80</td></tr>
                <tr><td>5</td><td style="text-align:right">0,75</td></tr>
                <tr><td>&ge; 6</td><td style="text-align:right">0</td></tr>
              </tbody>
            </table>
          </div>

          <div class="tableCard" id="occCard">
            <div class="tableHead">Tipos de Ocorrência (preencha as quantidades)</div>

            <div class="occTools">
              <input id="occSearch" type="text" placeholder="Buscar por código ou descrição..." />
              <button class="btn" id="btnZerarOc" type="button">Zerar ocorrências</button>
            </div>

            <div class="miniNote">
              Dica: informe apenas o que você teve no ano. A soma das ocorrências define automaticamente o <b>Extra</b>.
            </div>

            <table>
              <thead>
                <tr>
                  <th style="width:92px">Cód</th>
                  <th>Descrição</th>
                  <th style="text-align:right;width:120px">Qtd</th>
                </tr>
              </thead>
              <tbody id="occBody"></tbody>
            </table>
          </div>

        </div>
      </div>

    </div>

  </div>

  <div class="toast" id="toast">Copiado.</div>

  <script>
    // ---------- Helpers ----------
    const $ = (id)=>document.getElementById(id);

    function showToast(msg){
      const t = $("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1400);
    }

    function clamp(n, min, max){
      n = Number.isFinite(n) ? n : min;
      return Math.min(max, Math.max(min, n));
    }

    // aceita "1,23" e "1.23"
    function parseBRDecimal(v){
      if(v==null) return 0;
      const s = String(v).trim()
        .replace(/\./g, "")      // remove separador milhar (se houver)
        .replace(",", ".");      // decimal
      const n = Number(s);
      return Number.isFinite(n) ? n : 0;
    }

    function formatBR(n, decimals=2){
      const x = Number.isFinite(n) ? n : 0;
      return x.toLocaleString("pt-BR", {
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      });
    }

    function formatMoney(n){
      const x = Number.isFinite(n) ? n : 0;
      return "R$ " + x.toLocaleString("pt-BR", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    // ---------- Regras ----------
    function extraByOccurrences(total){
      // faixas conforme especificação
      if(total < 1) return 0.20;
      if(total < 3) return 0.15;
      if(total < 5) return 0.10;
      if(total < 7) return 0.05;
      return 0.00;
    }

    function coefByFaltas(f){
      if(f <= 0) return 1.00;
      if(f === 1) return 0.95;
      if(f === 2) return 0.90;
      if(f === 3) return 0.85;
      if(f === 4) return 0.80;
      if(f === 5) return 0.75;
      return 0.00; // >= 6
    }

    // Tipos de ocorrência (peso 1 conforme lista recebida)
    const OCC = [
      { code: "210",  desc: "Licença Médica INSS" },
      { code: "340",  desc: "Suspensão" },
      { code: "350",  desc: "Faltas não justificadas s/ DSR" },
      { code: "351",  desc: "Faltas não justificadas s/ DSR" },
      { code: "360",  desc: "Faltas Justificadas" },
      { code: "380",  desc: "Licença remunerada" },
      { code: "382",  desc: "Suspensão Contrato CLT x Estat" },
      { code: "385",  desc: "Licença remunerada s/ dedução" },
      { code: "390",  desc: "Licença não remunerada" },
      { code: "395",  desc: "Afastamento Reclusão" },
      { code: "9390", desc: "Licença não remunerada / Inquérito" },
      { code: "9400", desc: "Suspensão Contrato de Trabalho" },
      { code: "9410", desc: "Aposentadoria por Invalidez" },
    ];

    const occState = Object.fromEntries(OCC.map(o=>[o.code, 0]));

    function renderOccurrences(filter=""){
      const body = $("occBody");
      body.innerHTML = "";

      const f = filter.trim().toLowerCase();

      const rows = OCC.filter(o=>{
        if(!f) return true;
        return o.code.toLowerCase().includes(f) || o.desc.toLowerCase().includes(f);
      });

      rows.forEach(o=>{
        const tr = document.createElement("tr");

        const tdCode = document.createElement("td");
        tdCode.className = "codeCell";
        tdCode.textContent = o.code;

        const tdDesc = document.createElement("td");
        tdDesc.textContent = o.desc;

        const tdQty = document.createElement("td");
        tdQty.className = "qty";

        const inp = document.createElement("input");
        inp.type = "number";
        inp.min = "0";
        inp.step = "1";
        inp.value = occState[o.code] ?? 0;
        inp.addEventListener("input", ()=>{
          const v = Math.max(0, Math.floor(Number(inp.value || 0)));
          occState[o.code] = v;
          calcRealtime();
        });

        tdQty.style.textAlign = "right";
        tdQty.appendChild(inp);

        tr.appendChild(tdCode);
        tr.appendChild(tdDesc);
        tr.appendChild(tdQty);

        body.appendChild(tr);
      });
    }

    function totalOccurrences(){
      return Object.values(occState).reduce((a,b)=>a + (Number(b)||0), 0);
    }

    // ---------- Cálculo em tempo real ----------
    function calcRealtime(){
      const coletivo = parseBRDecimal($("inpColetivo").value);
      const salario  = parseBRDecimal($("inpSalario").value);
      const meses    = clamp(parseInt($("inpMeses").value || "0", 10), 0, 12);
      const faltas   = Math.max(0, parseInt($("inpFaltas").value || "0", 10));

      const occTotal = totalOccurrences();
      const extra = extraByOccurrences(occTotal);
      const coef  = coefByFaltas(faltas);

      // Fórmula:
      // PPR = Salário * (Meses/12) * (ResultadoColetivo + Extra) * CoefFaltas
      const base = (coletivo + extra) * coef;
      const ppr  = salario * (meses/12) * base;

      $("vColetivo").textContent = formatBR(coletivo, 4);
      $("vExtra").textContent    = formatBR(extra, 4);
      $("vCoef").textContent     = formatBR(coef, 2);
      $("vSalario").textContent  = formatMoney(salario);
      $("vMeses").textContent    = `${meses}/12`;
      $("vPpr").textContent      = formatMoney(ppr);
      $("pprBig").textContent    = formatMoney(ppr);

      // baseLine com contexto (inclui ocorrências)
      $("baseLine").textContent =
        `Base: Salário Dez/25 • Meses • Coletivo (${formatBR(coletivo,2)}) + Extra (${formatBR(extra,2)}) • Coef. Faltas (${formatBR(coef,2)}) • Ocorrências (${occTotal})`;

      // guarda para copiar
      window.__ppr_value = ppr;
    }

    function resetAll(){
      $("inpColetivo").value = "1,00";
      $("inpSalario").value  = "";
      $("inpMeses").value    = "12";
      $("inpFaltas").value   = "0";

      for(const k of Object.keys(occState)) occState[k]=0;
      $("occSearch").value = "";
      renderOccurrences("");

      calcRealtime();
      showToast("Resetado.");
    }

    // ---------- Eventos ----------
    ["inpColetivo","inpSalario","inpMeses","inpFaltas"].forEach(id=>{
      $(id).addEventListener("input", calcRealtime);
    });

    $("occSearch").addEventListener("input", (e)=>renderOccurrences(e.target.value));

    $("btnZerarOc").addEventListener("click", ()=>{
      for(const k of Object.keys(occState)) occState[k]=0;
      renderOccurrences($("occSearch").value);
      calcRealtime();
      showToast("Ocorrências zeradas.");
    });

    $("btnHome").addEventListener("click", ()=>location.href="index.html");

    $("btnCopy").addEventListener("click", async ()=>{
      const v = window.__ppr_value || 0;
      const txt = formatMoney(v);
      try{
        await navigator.clipboard.writeText(txt);
        showToast("Valor copiado.");
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = txt;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        showToast("Valor copiado.");
      }
    });

    $("btnReset").addEventListener("click", resetAll);

    // ---------- Init ----------
    renderOccurrences("");
    resetAll();
  </script>
</body>
</html>
